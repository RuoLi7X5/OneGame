<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>游戏合集</title>
    <link rel="icon" href="pictures/heibai01.png" type="image/png" />
    <link rel="stylesheet" href="home.css" />
  </head>
  <body>
    <header class="header">
      <div class="brand">
        <div class="logo">
          <img class="logo-img" src="pictures/heibai01.png" alt="Logo" />
          <span class="logo-text">OneGame</span>
        </div>
      </div>
    </header>
    <div class="scene-decor">
      <div class="corner-decor" style="background-image: url('pictures/fengshu.png');"></div>
      
      
      <canvas id="leafCanvas"></canvas>
    </div>

    <main class="main">
      <section class="menu">
        <a class="menu-item" href="chengyucaici/index.html">
          <div class="menu-title">成语猜词</div>
          <div class="menu-sub">按位反馈声母 / 韵母 / 声调</div>
        </a>
        <a class="menu-item" href="shuerte/index.html">
          <div class="menu-title">舒尔特表格</div>
          <div class="menu-sub">按序点击 1 至 N²，快速完成</div>
        </a>
      </section>
    </main>

    <footer class="footer">
      <small>更多小游戏即将上线</small>
    </footer>
    <script>
      const prefersReduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const canvas = document.getElementById('leafCanvas');
      const ctx = canvas.getContext('2d');
      let W = 0, H = 0, running = true;
      const leaves = [];
      let last = 0;
      let spawnAcc = 0;
      let baseSpawnRate = 0;
      let spawnToggle = 0;
      const mapleSrcs = ['pictures/fengye.png', 'pictures/fengye01.png'];
      const mapleImgs = mapleSrcs.map(src => {
        const img = new Image();
        img.src = src;
        return img;
      });
      // 简单检查所有图片加载（此处简化，只要任一加载即可开始，或等所有）
      // 实际绘制时会检查 img.complete
      
      let clicked = 0;
      let spawnMul = 1.0;
      let fallMul = 1.0;
      function updateMul(){
        if (clicked >= 50) { spawnMul = 2.0; fallMul = 1.7; }
        else if (clicked >= 30) { spawnMul = 1.5; fallMul = 1.3; }
        else if (clicked >= 10) { spawnMul = 1.2; fallMul = 1.0; }
        else { spawnMul = 1.0; fallMul = 1.0; }
      }
      function hitLeaf(l, mx, my){
        const dx = mx - l.x, dy = my - l.y;
        const ca = Math.cos(l.angle), sa = Math.sin(l.angle);
        const ux = dx*ca + dy*sa;
        const uy = -dx*sa + dy*ca;
        if (l.type === 'maple'){
          const img = l.img;
          if (!img || !img.complete || !img.naturalWidth) return false;
          const hw = l.size*0.5;
          const hh = hw * (img.height / img.width);
          return Math.abs(ux) <= hw && Math.abs(uy) <= hh;
        } else {
          const rx = 0.35*l.size, ry = 0.60*l.size;
          return (ux*ux)/(rx*rx) + (uy*uy)/(ry*ry) <= 1.0;
        }
      }
      function resize(){
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener('resize', resize);
      function rand(min, max){ return min + Math.random()*(max-min); }
      function makeMaple(){
        const baseBamboo = (10+18)/2;
        const baseMaple = baseBamboo * 2;
        const size = baseMaple * rand(0.85, 1.15);
        const x = rand(W*0.60, W*0.98);
        const y = rand(-60, H*0.12);
        const vx = rand(-10, 10) / 60;
        const vy = rand(16, 40) / 60;
        const spin = rand(-50, 50) / 60;
        const angle = rand(0, Math.PI*2);
        const alpha = 0.0;
        const maxAlpha = rand(0.38, 0.62);
        const hue = rand(8, 18);
        const sat = rand(45, 60);
        const light = rand(55, 68);
        const phaseX = rand(0, Math.PI*2);
        const phaseY = rand(0, Math.PI*2);
        const freqX = rand(0.9, 1.8);
        const freqY = rand(0.8, 1.6);
        const oscAmpX = rand(0.10, 0.22);
        const liftAmp = rand(0.02, 0.06);
        const gustAmp = rand(0.02, 0.08);
        const gustFreq = rand(0.10, 0.20);
        const vTerm = rand(0.60, 0.95);
        const g = rand(0.02, 0.06);
        const distY = (H+60) - y;
        const avgVy = (vy + vTerm) / 2;
        const tBottom = distY / Math.max(0.001, avgVy) / 60;
        const early = Math.random() < 0.40;
        const life = early ? tBottom * rand(0.70, 0.98) : tBottom * rand(1.02, 1.50);
        
        // 随机选择一张图
        const imgIndex = Math.floor(Math.random() * mapleImgs.length);
        const img = mapleImgs[imgIndex];
        
        leaves.push({ type:'maple', x, y, vx, vy, spin, angle, size, life, t: 0, alpha, maxAlpha, hue, sat, light, phaseX, phaseY, freqX, freqY, oscAmpX, liftAmp, gustAmp, gustFreq, vTerm, g, img });
      }
      function makeBamboo(){
        const size = rand(10, 18);
        const x = rand(W*0.02, W*0.40);
        const y = rand(-60, H*0.12);
        const vx = rand(-10, 10) / 60;
        const vy = rand(16, 40) / 60;
        const spin = rand(-22, 22) / 60;
        const angle = rand(-0.4, 0.4);
        const alpha = 0.0;
        const hue = rand(140, 160);
        const sat = rand(25, 45);
        const light = rand(58, 72);
        const phaseX = rand(0, Math.PI*2);
        const phaseY = rand(0, Math.PI*2);
        const freqX = rand(1.0, 2.0);
        const freqY = rand(0.9, 1.7);
        const oscAmpX = rand(0.08, 0.18);
        const liftAmp = rand(0.02, 0.05);
        const gustAmp = rand(0.02, 0.07);
        const gustFreq = rand(0.10, 0.20);
        const vTerm = rand(0.55, 0.90);
        const g = rand(0.02, 0.05);
        const distY = (H+60) - y;
        const avgVy = (vy + vTerm) / 2;
        const tBottom = distY / Math.max(0.001, avgVy) / 60;
        const early = Math.random() < 0.40;
        const life = early ? tBottom * rand(0.70, 0.98) : tBottom * rand(1.02, 1.50);
        leaves.push({ type:'bamboo', x, y, vx, vy, spin, angle, size, life, t: 0, alpha, hue, sat, light, phaseX, phaseY, freqX, freqY, oscAmpX, liftAmp, gustAmp, gustFreq, vTerm, g });
      }
      const maxLeaves = prefersReduce ? 0 : (Math.min(48, Math.max(24, Math.floor((W*H)/18000))));
      baseSpawnRate = prefersReduce ? 0 : Math.max(0.6, Math.min(1.6, maxLeaves/12));
      function drawMaple(l){
        const img = l.img;
        if (!img || !img.complete || !img.naturalWidth) return;
        const s = l.size;
        ctx.save();
        ctx.translate(l.x, l.y);
        ctx.rotate(l.angle);
        ctx.globalAlpha = l.alpha;
        // 增强颜色：提高饱和度和对比度
        ctx.filter = 'saturate(1.5) contrast(1.2)';
        const scale = s / img.width;
        ctx.drawImage(img, -img.width*0.5*scale, -img.height*0.5*scale, img.width*scale, img.height*scale);
        ctx.filter = 'none';
        ctx.globalAlpha = 1;
        ctx.restore();
      }
      function drawBamboo(l){
        const s = l.size;
        ctx.save();
        ctx.translate(l.x, l.y);
        ctx.rotate(l.angle);
        ctx.fillStyle = `hsla(${l.hue}, ${l.sat}%, ${l.light}%, ${l.alpha})`;
        const p = new Path2D();
        p.moveTo(0, -0.60*s);
        p.quadraticCurveTo(0.45*s, -0.18*s, 0, 0.60*s);
        p.quadraticCurveTo(-0.45*s, -0.18*s, 0, -0.60*s);
        ctx.fill(p);
        ctx.restore();
      }
      document.addEventListener('click', (e)=>{
        const mx = e.clientX;
        const my = e.clientY;
        for (let i = leaves.length-1; i >= 0; i--){
          const l = leaves[i];
          if (hitLeaf(l, mx, my)) { leaves.splice(i,1); clicked++; updateMul(); break; }
        }
      });
      function step(ts){
        if (!running) return;
        if (!last) last = ts;
        const dt = Math.min(0.032, (ts-last)/1000);
        last = ts;
        ctx.clearRect(0,0,W,H);
        if (leaves.length < maxLeaves) {
          const rate = baseSpawnRate * spawnMul;
          spawnAcc += dt * rate;
          while (spawnAcc >= 1 && leaves.length < maxLeaves) {
            if ((spawnToggle++ % 2) === 0) makeMaple(); else makeBamboo();
            spawnAcc -= 1;
          }
        }
        for (let i = leaves.length-1; i >= 0; i--) {
          const l = leaves[i];
          l.t += dt;
          const oscX = Math.sin(l.t*(l.freqX||1.2) + (l.phaseX||0))*(l.oscAmpX||0.12);
          const gustX = Math.sin(l.t*(l.gustFreq||0.14) + (l.phaseX||0))* (l.gustAmp||0.04);
          const oscY = Math.cos(l.t*(l.freqY||1.1) + (l.phaseY||0))* (l.liftAmp||0.03);
          l.vy = Math.min((l.vTerm||0.8)*fallMul, l.vy + (l.g||0.03)*fallMul*dt);
          l.x += l.vx + oscX + gustX;
          l.y += l.vy + oscY;
          l.angle += l.spin*dt;
          l.alpha = Math.min((l.maxAlpha||0.6), l.alpha + 0.02);
          if (l.t > l.life || l.y > H+60) { leaves.splice(i,1); continue; }
          if (l.type==='bamboo') drawBamboo(l); else drawMaple(l);
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);

    </script>
  </body>
  </html>
